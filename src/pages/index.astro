---
export const prerender = true;
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import PlushieCard from "../components/PlushieCard.astro";
import PlaceholderCard from "../components/PlaceholderCard.astro";
import { getCollection } from "astro:content";

const plushies = await getCollection("plushies");
const placeholderCount = 7; // Add 7 placeholder cards to fill the grid
const itemsPerPage = 8; // Show 8 items initially
---

<Layout title="Plushies.dev // The Open Source Tech Plushie Database">
	<Header />

    <div class="hero-section flex flex-col items-center justify-center text-center pb-16 relative z-10">
        <div class="inline-block px-3 py-1 border border-[var(--accent-neon)] rounded-full text-[10px] font-mono text-[var(--accent-neon)] uppercase mb-6 tracking-widest backdrop-blur-sm">
            // OPEN SOURCE COLLECTION
        </div>
        <h1 class="text-4xl md:text-7xl font-bold uppercase mb-8 tracking-tighter leading-none">
            The <span class="text-[var(--accent-neon)]">Tech Plushie</span><br/>
            Database
        </h1>
        <p class="text-[var(--text-muted)] font-mono text-sm md:text-base max-w-2xl mx-auto leading-relaxed uppercase">
            Build your digital collection of developer companions.
            <br/>
            Track, collect and share your softest stack with the community.
        </p>
    </div>

    <!-- Spacer to prevent overlap and ensure airiness -->
    <div class="h-32 w-full"></div>

	<section class="archive-grid" id="grid">
		{
			plushies.map((plushie, index) => (
				<PlushieCard
					plushie={plushie}
					class={index >= itemsPerPage ? "hidden load-more-item" : ""}
				/>
			))
		}
		{
			Array.from({ length: placeholderCount }).map((_, index) => (
				<PlaceholderCard
					class={
						plushies.length + index >= itemsPerPage
							? "hidden load-more-item"
							: ""
					}
				/>
			))
		}
	</section>

	{
		plushies.length + placeholderCount > itemsPerPage && (
			<div class="text-center mt-12 mb-8">
				<button
					id="load-more-btn"
					class="btn-archive text-lg px-8 py-4"
				>
					LOAD MORE [+
					{plushies.length + placeholderCount - itemsPerPage}]
				</button>
			</div>
		)
	}
</Layout>

<script>
	const loadMoreBtn = document.getElementById("load-more-btn");
	const hiddenItems = document.querySelectorAll(".load-more-item");
	let currentIndex = 0;
	const itemsToShow = 8;

	if (loadMoreBtn) {
		loadMoreBtn.addEventListener("click", () => {
			const itemsToReveal = Array.from(hiddenItems).slice(
				currentIndex,
				currentIndex + itemsToShow,
			);
			itemsToReveal.forEach((item) => {
				item.classList.remove("hidden");
			});

			currentIndex += itemsToShow;

			// Update button text
			const remaining = hiddenItems.length - currentIndex;
			if (remaining > 0) {
				loadMoreBtn.textContent = `LOAD MORE [+${remaining}]`;
			} else {
				loadMoreBtn.style.display = "none";
			}
		});
	}
</script>
